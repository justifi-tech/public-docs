<!-- b6fbec35-ed9a-41eb-b124-7ced98d01630 54291df6-8c37-4652-ac3b-c8664b2aed47 -->
# Integrate Web Components docs (with versioning)

## Inputs

- Source repo: [web-component-library](https://github.com/justifi-tech/web-component-library)
- Docs locations: `packages/webcomponents/src/components/**` (per-component folders)
- Package: [`@justifi/webcomponents` package.json](https://raw.githubusercontent.com/justifi-tech/web-component-library/main/packages/webcomponents/package.json)
- This site: Docusaurus in `docusaurus.config.ts`, existing `docs/` and `sidebars.ts`

## Integration approach

- **Primary**: CI-time sync of generated docs from the private source repo into `external/webcomponents-docs/` before building this site. Keeps private repo code out of this repo while publishing compiled docs.
- **Alternative (fallback)**: Git subtree/submodule into `external/wcl/` and run a local transform to collate docs. Requires repo access for devs and careful leakage control if this repo is public.

## Implementation in this repo (public-docs)

- **Add a second docs plugin instance** in `docusaurus.config.ts`:
  - `id: 'webcomponents'`
  - `path: 'external/webcomponents-docs'`
  - `routeBasePath: 'web-components'`
  - `sidebarPath: 'sidebars.webcomponents.ts'`
  - `versions`: enable versioning for this plugin instance
```ts
// docusaurus.config.ts (excerpt)
plugins: [
  [
    '@docusaurus/plugin-content-docs',
    {
      id: 'webcomponents',
      path: 'external/webcomponents-docs',
      routeBasePath: 'web-components',
      sidebarPath: require.resolve('./sidebars.webcomponents.ts'),
      editCurrentVersion: false,
      lastVersion: 'current',
      versions: { current: { label: 'Next' } },
      includeCurrentVersion: true,
    },
  ],
],
// navbar link for quick access
themeConfig: {
  navbar: {
    items: [
      { to: '/web-components/intro', label: 'Web Components', position: 'left' },
    ],
  },
}
```

- **Create `sidebars.webcomponents.ts`**: either autogenerated from filesystem or a stable structure (categories per component group). Keep the left-hand label as “Web Components”.
- **Surface in the main sidebar**: users will land on `/web-components/...` via navbar; once inside, the left sidebar shows the Web Components tree. No changes to `sidebars.ts` are required for cross-plugin sidebars.
- **Version switcher**: use per-plugin versioning. Docusaurus renders a version dropdown when the plugin has multiple versions. We’ll:
  - Bootstrap `current` from the latest source.
  - Add released versions using the Docusaurus versioning command for this plugin ID (executed in CI before build), producing `versioned_docs/webcomponents/*` and `versions.json`.
- **Assets & links**: copy any images used by docs into `external/webcomponents-docs` alongside MDX, or into `static/web-components/` with link rewriting as needed.

## CI workflow (this repo)

- **Secrets**: add `WCL_REPO_TOKEN` with read access to `justifi-tech/web-component-library`.
- **Job steps** (high level):

  1. Checkout this repo.
  2. Checkout the source repo at a target ref (branch or tag) using the token.
  3. Install minimal deps if needed for doc generation.
  4. Generate docs bundle (see “Source repo requirements”). Output to `external/webcomponents-docs/`.
  5. Generate or update `sidebars.webcomponents.ts` (script can reflect filesystem to categories).
  6. Versioning:

     - For each selected tag (e.g., latest minor for each major), run the generation into a staging dir, run `docusaurus docs:version:webcomponents <version>`, then replace the versioned docs content with the staging output.

  1. Build and deploy this site.

- **Local dev**: add a `pnpm sync:webcomponents` script that accepts a token (via env) to fetch/generate docs into `external/webcomponents-docs` for local preview.

## Source repo requirements (web-component-library)

- **Stable docs source** under `packages/webcomponents/src/components/**`:
  - Ensure each component exposes a docs MD/MDX (or README) with consistent frontmatter (`title`, `sidebar_label`, optional `slug`).
  - Prefer colocated assets (images) within the component directory.
- **Exportable docs generation**:
  - Provide a script (e.g., `pnpm -F @justifi/webcomponents docs:export`) that:
    - Runs Stencil’s docs generation (`stencil build --docs`) to produce structured metadata.
    - Emits Docusaurus-friendly MDX files per component into a single folder (e.g., `packages/webcomponents/docs-export/`), preserving component grouping.
    - Copies referenced assets.
- **Versioning hooks**:
  - Tag releases (`v6.1.1`, etc.).
  - Ensure `docs:export` is reproducible at any tag.
- **MDX compatibility**:
  - Avoid Storybook-only MDX syntax for exported docs, or gate it with fallbacks.
  - Keep imports limited to standard MDX and any shared components that can be vendored or inlined.

## Versioning model

- **Baseline**: publish `current` from `main`.
- **Released versions**: CI builds docs from selected tags (e.g., latest patch of each major) and registers them as versions for the `webcomponents` plugin instance. The version switcher will appear on all `/web-components/*` pages.

## Deliverables

- New plugin config and sidebar: `docusaurus.config.ts`, `sidebars.webcomponents.ts`.
- CI workflow to sync and version docs.
- Local sync script for developer preview.
- Minimal generator script(s) to transform/export docs (can live in this repo, but ideally in the source repo for reuse).

## Notes

- The source repo uses Stencil and already mentions `stencil build --docs` in its documentation, which we’ll leverage for consistent metadata and content generation ([repo](https://github.com/justifi-tech/web-component-library), [`package.json`](https://raw.githubusercontent.com/justifi-tech/web-component-library/main/packages/webcomponents/package.json)).

### To-dos

- [ ] Add second docs plugin with route /web-components-docs and navbar item
- [ ] Create Node script to copy/transform READMEs and assets into external/web-components-docs
- [ ] Add GitHub Actions workflow to fetch private repo and run sync before build
- [ ] Start with autogenerated sidebar; add optional overrides with _meta.json or sidebars.webcomponents.js
- [ ] Add pnpm script to run the sync locally with a token